version: 2.1
orbs:
  newman: postman/newman@0.0.2
jobs:
  build:
    executor: newman/postman-newman-docker
    steps:
      - checkout
      - newman/newman-run:
          collection: ./test/postman_collection.json
          ignore-redirects: true
          additional-options: -r cli,junit,json              
           
      - run:
          name: Save Test Result
          command: |
            echo "***my artifact files ***" 
            mkdir -p api/test-results/newman
            cp ./newman/newman-run-report-*.xml api/test-results/newman
            cp ./newman/newman-run-report-*.json api/test-results/newman
            echo ${CIRCLE_BRANCH}
            echo ${CIRCLE_BUILD_NUM}
       
         
      - store_test_results:
          path: api/test-results
          
      - store_artifacts:
          path: api/test-results/newman
          
workflows:
  version: 2
  weekly:
    triggers:
      - schedule:
          cron: "0 0 3 ? * THU *" # every Thurs at noon
          filters:
            branches:
              only:
                - main
    jobs:
      - build

  manual:
    jobs:
      - build
